<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>üéØ Gerador de Bilhete üéüÔ∏è Beta</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
:root{
  --bg:#000000;
  --panel:#07100b;
  --muted:#bfbfbf;
  --accent:#00ff66;
  --accent-2:#00cc66;
  --card:#0f0f0f;
  --sidebar-width:260px;
}
*{box-sizing:border-box}
body{margin:0;font-family:"Montserrat",system-ui,Arial,sans-serif;background:var(--bg);color:#f2f2f2;-webkit-font-smoothing:antialiased;}
a{color:inherit}
.sidebar{
  position:fixed;left:0;top:0;bottom:0;width:var(--sidebar-width);background:#040504;border-right:1px solid rgba(0,255,102,0.06);
  padding:18px 12px;display:flex;flex-direction:column;gap:14px;
}
.brand{display:flex;align-items:center;gap:10px}
.brand h2{margin:0;color:var(--accent);font-size:16px}
.menu{display:flex;flex-direction:column;gap:8px;margin-top:6px}
.menu button{display:flex;gap:8px;align-items:center;padding:10px;border-radius:10px;border:none;background:transparent;color:var(--muted);cursor:pointer;text-align:left}
.menu button.active{background:linear-gradient(90deg, rgba(0,255,102,0.06), rgba(0,255,102,0.02));color:#000;background-color:var(--accent);font-weight:700}
.menu .sep{height:1px;background:rgba(255,255,255,0.02);margin:8px 0}
.logout{margin-top:auto}
.wrap{margin-left:var(--sidebar-width);padding:22px;min-height:100vh}
.header{display:flex;justify-content:space-between;align-items:center;gap:10px}
.header h1{margin:0;color:var(--accent);font-size:20px}
.controls{margin-top:18px;background:var(--panel);padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.02)}
.row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
label.small{font-size:13px;color:var(--muted);display:flex;flex-direction:column;align-items:flex-start;}
input[type=number], input[type=text], select {background:#0b0b0b;border:1px solid #171717;color:#f2f2f2;padding:8px;border-radius:8px;width:120px}
.btn{background:var(--accent);color:#000;padding:10px 14px;border-radius:10px;border:none;cursor:pointer;font-weight:700}
.ghost{background:transparent;border:1px solid #222;color:var(--muted);padding:8px 12px;border-radius:8px}
.actions{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-top:12px}
.chips{display:flex;gap:8px;flex-wrap:wrap}
.chip{background:#101010;border:1px solid #161616;color:#ddd;padding:8px 12px;border-radius:12px;cursor:pointer;user-select:none}
.chip.active{background:var(--accent);color:#000;transform:scale(1.02);box-shadow:0 6px 18px rgba(0,255,102,0.06)}
#bilheteContainer{margin-top:18px;display:flex;flex-direction:column;gap:12px;min-height:140px;align-items:center}

/* card / bilhete */
.card{background:var(--card);border:1px solid rgba(0,255,102,0.06);padding:16px;border-radius:12px;opacity:0;transform:translateY(20px) scale(.98);transition:all .38s cubic-bezier(.2,.9,.3,1);width:100%;max-width:820px}
.card.show{opacity:1;transform:none}
.card h3{margin:0;color:#fff;font-size:16px}
.meta{font-size:13px;color:var(--muted);margin-top:6px}
.stats-line{margin-top:10px;font-size:14px;color:var(--accent)}
.small{font-size:13px;color:var(--muted)}

/* modal destaque */
#bilheteModal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.85);z-index:9999}
#bilheteModal.show{display:flex}
.modalCard{width:92%;max-width:760px;background:linear-gradient(180deg,#0d0d0d,#090909);padding:18px;border-radius:12px;border:1px solid rgba(0,255,102,0.06);transform:scale(.9);opacity:0;transition:all .28s}
#bilheteModal.show .modalCard{transform:scale(1);opacity:1}

/* modal estat */
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.85);z-index:60;padding:28px;overflow:auto}
.modal .panel{max-width:900px;margin:20px auto;background:#070707;padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
table.stats{width:100%;border-collapse:collapse;margin-top:10px;color:var(--muted);font-size:14px}
table.stats th, table.stats td{padding:8px;border-bottom:1px solid rgba(255,255,255,0.02);text-align:left}

/* responsive */
@media(max-width:900px){ .sidebar{display:none} .wrap{margin-left:0;padding:14px} }
</style>
</head>
<body>

<!-- SIDEBAR -->
<nav class="sidebar" aria-label="Menu principal">
  <div class="brand">
    <div style="width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,#07150b,#001a0d);display:flex;align-items:center;justify-content:center;color:var(--accent);font-weight:800">üéØ</div>
    <div>
      <h2>Gerador de Bilhete</h2>
      <div class="small" style="color:var(--muted)">Beta</div>
    </div>
  </div>

  <div class="menu" role="menu" aria-hidden="false">
    <button id="menuBilhetes" class="active">‚öΩ Palpites / Gerar</button>
    <button id="menuEstat">üìä Estat√≠sticas</button>
    <button id="menuPix">üí∞ Pix</button>
    <div class="sep"></div>
    <button id="menuCopiar">üìã Copiar</button>
    <button id="menuPdf">üíæ PDF</button>
    <div class="sep"></div>
    <button id="menuLogout" class="ghost">üîê Logout</button>
  </div>

  <div class="logout">
    <div class="small" style="color:var(--muted);margin-bottom:8px">C√≥digos:</div>
    <div class="small" style="color:var(--muted)">Admin: <strong>082111</strong></div>
    <div class="small" style="color:var(--muted)">25x 24h ‚Ä¢ 24x 30d</div>
  </div>
</nav>

<!-- MAIN -->
<div class="wrap" role="main">
  <div class="header">
    <h1>üéØ Gerador de Bilhete üéüÔ∏è</h1>
    <div class="small">Tema escuro ‚Ä¢ Neon</div>
  </div>

  <!-- login overlay (center) -->
  <div id="loginOverlay" style="position:fixed;inset:0;background:rgba(0,0,0,0.92);display:flex;align-items:center;justify-content:center;z-index:9998">
    <div id="loginBox" style="background:#0b0b0b;padding:22px;border-radius:12px;width:96%;max-width:420px;border:1px solid rgba(255,255,255,0.02);text-align:center">
      <h2 style="margin:0 0 8px;color:var(--accent)">üéØ Gerador de Bilhete</h2>
      <input id="loginCode" placeholder="Digite seu c√≥digo (ex: 174325)" style="padding:10px;border-radius:8px;border:1px solid #222;width:100%;margin-bottom:10px;background:#111;color:#fff" autocomplete="off">
      <div style="display:flex;gap:8px;justify-content:center">
        <button id="loginBtn" class="btn">Entrar</button>
        <button id="loginShowCodes" class="ghost">Mostrar (dev)</button>
      </div>
      <div id="loginMsg" style="color:#f33;margin-top:8px;font-size:13px"></div>
      <div style="margin-top:10px;font-size:13px;color:var(--muted)">C√≥digos s√£o de uso √∫nico (exceto admin). Estado salvo localmente.</div>
    </div>
  </div>

  <!-- CONTROLS -->
  <section class="controls" aria-labelledby="controlsTitle">
    <div class="row" style="justify-content:space-between">
      <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap">
        <label class="small">Quantidade de jogos
          <input id="qtd" type="number" min="1" value="3">
        </label>
        <label class="small">Odd m√≠nima
          <input id="minOdd" type="number" step="0.01" value="1.20">
        </label>
        <label class="small">Odd m√°xima
          <input id="maxOdd" type="number" step="0.01" value="2.50">
        </label>
        <label class="small">% m√≠nimo de acerto
          <input id="minPercent" type="number" step="1" value="50">
        </label>
      </div>

      <div style="display:flex;gap:8px;align-items:center">
        <button id="generateBtn" class="btn" style="font-size:15px;padding:10px 18px;">üé≤ Gerar Bilhete</button>
      </div>
    </div>

    <div style="margin-top:12px" class="small">Filtros</div>

    <div style="margin-top:8px" class="row">
      <div>
        <div class="small" style="margin-bottom:6px">Esportes</div>
        <div id="sportsWrap" class="chips"></div>
      </div>

      <div>
        <div class="small" style="margin-bottom:6px">Mercados</div>
        <div id="marketsWrap" class="chips" style="max-width:520px"></div>
      </div>

      <div>
        <div class="small" style="margin-bottom:6px">Data</div>
        <div id="daysWrap" class="chips"></div>
      </div>
    </div>

    <div class="actions">
      <button id="estatBtn" class="btn">üìä Estat√≠sticas</button>
      <button id="copiarBtn" class="btn">üìã Copiar</button>
      <button id="pdfBtn" class="btn">üíæ PDF</button>
    </div>

    <div style="margin-top:12px">
      <button id="pixBtn" class="btn" style="background:#ffcc00;color:#000;width:100%;">Pix e-mail: geradordebilhete@gmail.com ‚Äî Clique para copiar (ajude um pobre)</button>
    </div>
  </section>

  <!-- bilhetes area -->
  <div id="bilheteContainer" aria-live="polite"></div>

</div>

<!-- BILHETE MODAL -->
<div id="bilheteModal" aria-hidden="true">
  <div class="modalCard" role="document">
    <div id="modalBilheteInner"></div>
    <div style="text-align:right;margin-top:12px;">
      <button id="closeModal" class="btn">Fechar</button>
    </div>
  </div>
</div>

<!-- ESTAT MODAL -->
<div id="estatModal" class="modal" aria-hidden="true">
  <div class="panel">
    <button id="closeEstat" style="float:right;background:var(--accent);border:none;padding:8px 10px;border-radius:8px;cursor:pointer">Fechar</button>
    <h2>üìä Estat√≠sticas do Gerador</h2>
    <div id="estatContent" style="margin-top:8px"></div>
  </div>
</div>

<script>
/* ==========================
   LOGIN CODES (fixed)
   ========================== */
const loginCodes = [
  {code:"082111", tipo:"adm", usado:false, expira:null},
  {code:"174325", tipo:"teste24h", usado:false, expira:Date.now()+24*60*60*1000},
  {code:"693804", tipo:"teste24h", usado:false, expira:Date.now()+24*60*60*1000},
  {code:"251907", tipo:"teste24h", usado:false, expira:Date.now()+24*60*60*1000},
  {code:"810236", tipo:"teste24h", usado:false, expira:Date.now()+24*60*60*1000},
  {code:"492671", tipo:"teste24h", usado:false, expira:Date.now()+24*60*60*1000},
  {code:"357912", tipo:"teste24h", usado:false, expira:Date.now()+24*60*60*1000},
  {code:"608473", tipo:"teste24h", usado:false, expira:Date.now()+24*60*60*1000},
  {code:"135790", tipo:"teste24h", usado:false, expira:Date.now()+24*60*60*1000},
  {code:"984210", tipo:"teste24h", usado:false, expira:Date.now()+24*60*60*1000},
  {code:"426158", tipo:"teste24h", usado:false, expira:Date.now()+24*60*60*1000},
  {code:"751349", tipo:"teste24h", usado:false, expira:Date.now()+24*60*60*1000},
  {code:"603281", tipo:"teste24h", usado:false, expira:Date.now()+24*60*60*1000},
  {code:"940762", tipo:"teste24h", usado:false, expira:Date.now()+24*60*60*1000},
  {code:"817524", tipo:"teste24h", usado:false, expira:Date.now()+24*60*60*1000},
  {code:"265839", tipo:"teste24h", usado:false, expira:Date.now()+24*60*60*1000},
  {code:"308715", tipo:"teste24h", usado:false, expira:Date.now()+24*60*60*1000},
  {code:"576492", tipo:"teste24h", usado:false, expira:Date.now()+24*60*60*1000},
  {code:"102938", tipo:"teste24h", usado:false, expira:Date.now()+24*60*60*1000},
  {code:"847261", tipo:"teste24h", usado:false, expira:Date.now()+24*60*60*1000},
  {code:"539870", tipo:"teste24h", usado:false, expira:Date.now()+24*60*60*1000},
  {code:"624195", tipo:"teste24h", usado:false, expira:Date.now()+24*60*60*1000},
  {code:"781042", tipo:"teste24h", usado:false, expira:Date.now()+24*60*60*1000},
  {code:"910374", tipo:"teste24h", usado:false, expira:Date.now()+24*60*60*1000},
  {code:"468215", tipo:"teste24h", usado:false, expira:Date.now()+24*60*60*1000},
  {code:"352607", tipo:"teste24h", usado:false, expira:Date.now()+24*60*60*1000},
  {code:"839214", tipo:"30dias", usado:false, expira:Date.now()+30*24*60*60*1000},
  {code:"276153", tipo:"30dias", usado:false, expira:Date.now()+30*24*60*60*1000},
  {code:"490825", tipo:"30dias", usado:false, expira:Date.now()+30*24*60*60*1000},
  {code:"617348", tipo:"30dias", usado:false, expira:Date.now()+30*24*60*60*1000},
  {code:"203957", tipo:"30dias", usado:false, expira:Date.now()+30*24*60*60*1000},
  {code:"574908", tipo:"30dias", usado:false, expira:Date.now()+30*24*60*60*1000},
  {code:"361472", tipo:"30dias", usado:false, expira:Date.now()+30*24*60*60*1000},
  {code:"805139", tipo:"30dias", usado:false, expira:Date.now()+30*24*60*60*1000},
  {code:"942176", tipo:"30dias", usado:false, expira:Date.now()+30*24*60*60*1000},
  {code:"218563", tipo:"30dias", usado:false, expira:Date.now()+30*24*60*60*1000},
  {code:"430972", tipo:"30dias", usado:false, expira:Date.now()+30*24*60*60*1000},
  {code:"597284", tipo:"30dias", usado:false, expira:Date.now()+30*24*60*60*1000},
  {code:"821605", tipo:"30dias", usado:false, expira:Date.now()+30*24*60*60*1000},
  {code:"364790", tipo:"30dias", usado:false, expira:Date.now()+30*24*60*60*1000},
  {code:"719284", tipo:"30dias", usado:false, expira:Date.now()+30*24*60*60*1000},
  {code:"258631", tipo:"30dias", usado:false, expira:Date.now()+30*24*60*60*1000},
  {code:"106247", tipo:"30dias", usado:false, expira:Date.now()+30*24*60*60*1000},
  {code:"493820", tipo:"30dias", usado:false, expira:Date.now()+30*24*60*60*1000},
  {code:"867915", tipo:"30dias", usado:false, expira:Date.now()+30*24*60*60*1000},
  {code:"520374", tipo:"30dias", usado:false, expira:Date.now()+30*24*60*60*1000},
  {code:"138649", tipo:"30dias", usado:false, expira:Date.now()+30*24*60*60*1000},
  {code:"604872", tipo:"30dias", usado:false, expira:Date.now()+30*24*60*60*1000},
  {code:"791356", tipo:"30dias", usado:false, expira:Date.now()+30*24*60*60*1000},
  {code:"285197", tipo:"30dias", usado:false, expira:Date.now()+30*24*60*60*1000}
];

/* restore used flags */
(function restoreUsedFlags(){
  try{
    const saved = JSON.parse(localStorage.getItem('login_used_map')||'{}');
    loginCodes.forEach(c=>{ if(saved[c.code]) c.usado = true; });
  }catch(e){}
})();

function persistUsedFlags(){
  try{
    const map = {};
    loginCodes.forEach(c=>{ if(c.usado) map[c.code] = true; });
    localStorage.setItem('login_used_map', JSON.stringify(map));
  }catch(e){}
}

/* ========== LOGIN UI ========== */
const loginOverlay = document.getElementById('loginOverlay');
const loginInput = document.getElementById('loginCode');
const loginBtn = document.getElementById('loginBtn');
const loginMsg = document.getElementById('loginMsg');
const loginShowCodes = document.getElementById('loginShowCodes');

function saveLogin(code){ localStorage.setItem('loginCode', code); }

function checkExistingLogin(){
  const code = localStorage.getItem('loginCode');
  if(!code) return false;
  const user = loginCodes.find(c=>c.code === code);
  if(user && (!user.usado || user.tipo === 'adm')){
    loginOverlay.style.display = 'none';
    return true;
  }
  return false;
}

loginBtn.addEventListener('click', ()=>{
  const val = (loginInput.value||'').trim();
  if(!val){ loginMsg.textContent = 'Digite um c√≥digo.'; return; }
  const user = loginCodes.find(c=>c.code === val);
  if(!user){ loginMsg.textContent = 'C√≥digo inv√°lido.'; return; }
  if(user.usado && user.tipo !== 'adm'){ loginMsg.textContent = 'C√≥digo j√° usado.'; return; }
  if(user.expira && Date.now() > user.expira){ loginMsg.textContent = 'C√≥digo expirado.'; return; }
  user.usado = true;
  persistUsedFlags();
  saveLogin(val);
  loginOverlay.style.display = 'none';
  loginMsg.textContent = '';
});

let devShown=false;
loginShowCodes.addEventListener('click', ()=>{
  if(!devShown){
    const list = loginCodes.map(c=>`${c.code}${c.tipo==='adm'?' (adm)':''}${c.usado?' [USADO]':''}`).join(' ‚Ä¢ ');
    alert('C√≥digos internos: ' + list);
    loginShowCodes.textContent = 'Ocultar (dev)';
    devShown=true;
  } else {
    loginShowCodes.textContent = 'Mostrar (dev)';
    devShown=false;
  }
});
checkExistingLogin();

/* ==========================
   PALPITES (50) - dividido entre 'hoje' e 'amanha'
   ========================== */
const palpites = [
/* 25 palpites -> HOJE */
{esporte:"Futebol",dia:"hoje",jogo:"Liverpool x Manchester United",mercado:"Dupla Chance Casa",odd:1.16,percent:79},
{esporte:"Futebol",dia:"hoje",jogo:"Celta x Real Sociedad",mercado:"+1.5 gols",odd:1.30,percent:75},
{esporte:"Futebol",dia:"hoje",jogo:"Celta x Real Sociedad",mercado:"+0.5 gols Casa",odd:1.20,percent:90},
{esporte:"Futebol",dia:"hoje",jogo:"Getafe x Real Madrid",mercado:"Vit√≥ria Fora",odd:1.42,percent:62},
{esporte:"Futebol",dia:"hoje",jogo:"Getafe x Real Madrid",mercado:"Real ganhar 1T",odd:1.90,percent:50},
{esporte:"Futebol",dia:"hoje",jogo:"Getafe x Real Madrid",mercado:"Gol no 1T",odd:1.36,percent:80},
{esporte:"Futebol",dia:"hoje",jogo:"Freiburg x Frankfurt",mercado:"+1.5 gols",odd:1.20,percent:70},
{esporte:"Futebol",dia:"hoje",jogo:"St Pauli x Hoffenheim",mercado:"+1.5 gols",odd:1.25,percent:80},
{esporte:"Futebol",dia:"hoje",jogo:"Cagliari x Bologna",mercado:"-3.5 gols",odd:1.22,percent:90},
{esporte:"Futebol",dia:"hoje",jogo:"Cagliari x Bologna",mercado:"Dupla Chance Fora",odd:1.28,percent:60},
{esporte:"Futebol",dia:"hoje",jogo:"Lazio x Atalanta",mercado:"+1.5 gols",odd:1.25,percent:75},
{esporte:"Futebol",dia:"hoje",jogo:"Milan x Fiorentina",mercado:"+1.5 gols",odd:1.28,percent:72},
{esporte:"Futebol",dia:"hoje",jogo:"Milan x Fiorentina",mercado:"Dupla Chance Casa",odd:1.14,percent:70},
{esporte:"Futebol",dia:"hoje",jogo:"Lens x Paris",mercado:"+1.5 gols",odd:1.20,percent:75},
{esporte:"Futebol",dia:"hoje",jogo:"Lens x Paris",mercado:"Ambas Marcam",odd:1.60,percent:65},
{esporte:"Futebol",dia:"hoje",jogo:"Lens x Paris",mercado:"+0.5 gol 1T",odd:1.30,percent:68},
{esporte:"Futebol",dia:"hoje",jogo:"Nantes x Lille",mercado:"0.5 gol 1T",odd:1.36,percent:66},
{esporte:"Futebol",dia:"hoje",jogo:"Nantes x Lille",mercado:"Ambas Marcam",odd:1.75,percent:62},
{esporte:"Futebol",dia:"hoje",jogo:"San Martin SJ x Independiente",mercado:"-3.5 gols",odd:1.11,percent:70},
{esporte:"Futebol",dia:"hoje",jogo:"Empoli x Venezia",mercado:"-3.5 gols",odd:1.22,percent:75},
{esporte:"Futebol",dia:"hoje",jogo:"Rosario Central x Platense",mercado:"-3.5 gols",odd:1.14,percent:71},
{esporte:"Futebol",dia:"hoje",jogo:"Botafogo SP x Cuiab√°",mercado:"+0.5 gols Fora",odd:1.38,percent:68},
{esporte:"Futebol",dia:"hoje",jogo:"Lech Poznan x Pogon Szczecin",mercado:"Casa ou Empate",odd:1.22,percent:68},
{esporte:"Futebol",dia:"hoje",jogo:"Lech Poznan x Pogon Szczecin",mercado:"+1.5 gols",odd:1.14,percent:74},
{esporte:"Futebol",dia:"hoje",jogo:"Bahia x Gr√™mio",mercado:"Casa ou Empate",odd:1.18,percent:68},

/* 25 palpites -> AMANH√É */
{esporte:"Futebol",dia:"amanha",jogo:"Bahia x Gr√™mio",mercado:"+1.5 gols",odd:1.36,percent:70},
{esporte:"Futebol",dia:"amanha",jogo:"Nurnberg x Holstein Kiel",mercado:"+1.5 gols",odd:1.20,percent:69},
{esporte:"Futebol",dia:"amanha",jogo:"Tottenham x Aston Villa",mercado:"Dupla Chance Casa",odd:1.28,percent:70},
{esporte:"Futebol",dia:"amanha",jogo:"Tottenham x Aston Villa",mercado:"Ambas Marcam",odd:1.70,percent:65},
{esporte:"Futebol",dia:"amanha",jogo:"Tottenham x Aston Villa",mercado:"+2.5 gols",odd:1.90,percent:50},
{esporte:"Futebol",dia:"amanha",jogo:"Tottenham x Aston Villa",mercado:"+1.5 gols",odd:1.28,percent:72},
{esporte:"Futebol",dia:"amanha",jogo:"Liverpool x Manchester United",mercado:"Ambas Marcam",odd:1.50,percent:62},
{esporte:"Futebol",dia:"amanha",jogo:"Liverpool x Manchester United",mercado:"Vit√≥ria Casa",odd:1.60,percent:65},
{esporte:"Futebol",dia:"amanha",jogo:"Liverpool x Manchester United",mercado:"+0.5 gol 1T",odd:1.22,percent:58},
{esporte:"Futebol",dia:"amanha",jogo:"Liverpool x Manchester United",mercado:"+1.5 gols",odd:1.14,percent:72},
{esporte:"Futebol",dia:"amanha",jogo:"Liverpool x Manchester United",mercado:"+2.5 gols",odd:1.44,percent:48},
{esporte:"Futebol",dia:"amanha",jogo:"Cagliari x Bologna",mercado:"+0.5 gols Fora",odd:1.28,percent:90},
{esporte:"Futebol",dia:"amanha",jogo:"Cagliari x Bologna",mercado:"-1.5 gols 1T",odd:1.33,percent:70},
{esporte:"Futebol",dia:"amanha",jogo:"San Martin SJ x Independiente",mercado:"-1.5 gol 1T",odd:1.20,percent:68},
{esporte:"Futebol",dia:"amanha",jogo:"San Martin SJ x Independiente",mercado:"-0.5 gol 1T",odd:2.10,percent:48},
{esporte:"Futebol",dia:"amanha",jogo:"Empoli x Venezia",mercado:"-1.5 gols 1T",odd:1.33,percent:70},
{esporte:"Futebol",dia:"amanha",jogo:"Rosario Central x Platense",mercado:"Casa ou Empate",odd:1.11,percent:72},
{esporte:"Futebol",dia:"amanha",jogo:"Rosario Central x Platense",mercado:"Vit√≥ria Casa",odd:1.72,percent:66},
{esporte:"Futebol",dia:"amanha",jogo:"Botafogo SP x Cuiab√°",mercado:"-3.5 gols",odd:1.18,percent:70},
{esporte:"Futebol",dia:"amanha",jogo:"Lech Poznan x Pogon Szczecin",mercado:"Ambas Marcam",odd:1.50,percent:64},
{esporte:"Futebol",dia:"amanha",jogo:"Lech Poznan x Pogon Szczecin",mercado:"Vit√≥ria Casa",odd:1.72,percent:66},
{esporte:"Futebol",dia:"amanha",jogo:"Bahia x Gr√™mio",mercado:"+0.5 gol cada",odd:1.18,percent:68},
{esporte:"Futebol",dia:"amanha",jogo:"Nurnberg x Holstein Kiel",mercado:"+1.5 gols",odd:1.20,percent:69},
{esporte:"Futebol",dia:"amanha",jogo:"Tottenham x Aston Villa",mercado:"+1.5 gols",odd:1.28,percent:72}
];

/* ==========================
   UI lists: sports, markets, days (Hoje/Amanh√£)
   ========================== */
const sportsList = ["Futebol","Basquete","V√¥lei","T√™nis","E-Sports"];
const marketsList = ["Vit√≥ria","Dupla Chance","+0.5 Gols 1T","+0.5 Gols Casa","+0.5 Gols Fora","+1.5 Gols","+2.5 Gols","-3.5 Gols","Ambas Marcam","Gol no 1T","Casa ou Empate","+0.5 gol cada"];
const sportsWrap = document.getElementById('sportsWrap');
const marketsWrap = document.getElementById('marketsWrap');
const daysWrap = document.getElementById('daysWrap');

// render sport chips (default Futebol active)
sportsList.forEach((s, i)=>{
  const el = document.createElement('div');
  el.className = 'chip' + (s === 'Futebol' ? ' active' : '');
  el.dataset.value = s;
  el.textContent = s;
  el.addEventListener('click', ()=> el.classList.toggle('active'));
  sportsWrap.appendChild(el);
});

// render market chips (default all active)
marketsList.forEach(m=>{
  const el = document.createElement('div');
  el.className = 'chip active';
  el.dataset.value = m;
  el.textContent = m;
  el.addEventListener('click', ()=> el.classList.toggle('active'));
  marketsWrap.appendChild(el);
});

// days: Hoje / Amanh√£ chips (select exclusive)
(function renderDays(){
  const today = new Date();
  const tomorrow = new Date(Date.now() + 24*60*60*1000);
  const days = [
    {key:'hoje', label:`Hoje (${today.toLocaleDateString()})`},
    {key:'amanha', label:`Amanh√£ (${tomorrow.toLocaleDateString()})`}
  ];
  days.forEach((d,i)=>{
    const el = document.createElement('div');
    el.className = 'chip';
    // enable if there are games for that day
    const has = palpites.some(p => p.dia === d.key);
    el.textContent = d.label;
    el.dataset.value = d.key;
    if(has) el.classList.add('active');
    el.addEventListener('click', ()=>{
      document.querySelectorAll('#daysWrap .chip').forEach(c=>c.classList.remove('selected'));
      el.classList.add('selected');
    });
    daysWrap.appendChild(el);
    // auto-select the first day that has games
    if(has && !document.querySelector('#daysWrap .chip.selected')){
      el.classList.add('selected');
    }
  });
})();

/* helpers */
function getSelectedSports(){ return Array.from(document.querySelectorAll('#sportsWrap .chip.active')).map(n=>n.dataset.value); }
function getSelectedMarkets(){ return Array.from(document.querySelectorAll('#marketsWrap .chip.active')).map(n=>n.dataset.value.toLowerCase()); }
function getSelectedDay(){ const d = document.querySelector('#daysWrap .chip.selected'); return d ? d.dataset.value : null; }

function calcularRiscoFromPercent(avgPercent){
  if(avgPercent>=80) return 'Baixo';
  if(avgPercent>=60) return 'M√©dio';
  if(avgPercent>=40) return 'Alto';
  return 'Muito alto';
}

/* ========== BILHETE GENERATOR ========== */
const bilheteContainer = document.getElementById('bilheteContainer');
const generateBtn = document.getElementById('generateBtn');
const qtdInput = document.getElementById('qtd');
const minOddInput = document.getElementById('minOdd');
const maxOddInput = document.getElementById('maxOdd');
const minPercentInput = document.getElementById('minPercent');
const bilheteModal = document.getElementById('bilheteModal');
const modalBilheteInner = document.getElementById('modalBilheteInner');
const closeModal = document.getElementById('closeModal');

function gerarBilhete(){
  bilheteContainer.innerHTML = '';
  modalBilheteInner.innerHTML = '';

  const qtd = Math.max(1, Number(qtdInput.value) || 3);
  const minOdd = Number(minOddInput.value) || 1.01;
  const maxOdd = Number(maxOddInput.value) || 999;
  const minPerc = Number(minPercentInput.value) || 0;
  const selectedSports = getSelectedSports();
  const selectedMarkets = getSelectedMarkets();
  const selectedDay = getSelectedDay();

  if(!selectedDay){ alert('Selecione "Hoje" ou "Amanh√£"'); return; }

  // filter by day
  let filtered = palpites.filter(p => p.dia === selectedDay);

  if(filtered.length === 0){
    const card = document.createElement('div');
    card.className = 'card show';
    card.innerHTML = `<h3>‚ö†Ô∏è Sem palpites para ${selectedDay}</h3><div class="meta">N√£o h√° jogos cadastrados para essa data.</div>`;
    bilheteContainer.appendChild(card);
    return;
  }

  // filter by sport, market, odd, percent
  filtered = filtered.filter(p=>{
    const sportOK = selectedSports.length ? selectedSports.includes(p.esporte) : true;
    const marketOK = selectedMarkets.length ? selectedMarkets.includes(p.mercado.toLowerCase()) : true;
    const oddOK = (p.odd >= minOdd && p.odd <= maxOdd);
    const percOK = (p.percent >= minPerc);
    return sportOK && marketOK && oddOK && percOK;
  });

  if(filtered.length === 0){
    const card = document.createElement('div');
    card.className = 'card show';
    card.innerHTML = `<h3>‚ùå Nenhum jogo encontrado</h3><div class="meta">Ajuste filtros (esporte/mercado/odd/% m√≠nimo) ‚Äî nenhum palpite atende os crit√©rios.</div>`;
    bilheteContainer.appendChild(card);
    return;
  }

  // pick random unique
  const take = Math.min(qtd, filtered.length);
  const pool = filtered.slice();
  const chosen = [];
  let oddTotal = 1;
  let greenSum = 0;
  for(let i=0;i<take;i++){
    const idx = Math.floor(Math.random()*pool.length);
    const p = pool.splice(idx,1)[0];
    chosen.push(p);
    oddTotal *= p.odd;
    greenSum += p.percent;
  }

  // summary card
  const summarCard = document.createElement('div');
  summarCard.className = 'card show';
  let html = `<h3>Bilhete Gerado ‚Äî ${chosen.length} jogos</h3>`;
  html += `<div class="meta">Data: ${selectedDay[0].toUpperCase()+selectedDay.slice(1)} ‚Ä¢ Gerado: ${new Date().toLocaleString()}</div>`;
  html += '<div style="margin-top:10px">';
  chosen.forEach((p,i)=>{
    html += `<div style="padding:10px;border-radius:10px;background:linear-gradient(90deg,#080808,#0b0b0b);margin-bottom:8px;display:flex;justify-content:space-between;align-items:center">
      <div style="flex:1"><strong>${i+1}. ${p.jogo}</strong><div class="meta">${p.mercado}</div></div>
      <div style="text-align:right"><div style="font-weight:700">${p.odd.toFixed(2)}</div><div class="meta">${p.percent}%</div></div>
    </div>`;
  });
  const avgGreen = chosen.length ? (greenSum / chosen.length) : 0;
  html += `</div><div class="stats-line">Odd Final: <strong>${oddTotal.toFixed(2)}</strong> ‚Ä¢ % Green M√©dio: <strong>${avgGreen.toFixed(1)}%</strong> ‚Ä¢ Risco: <strong>${calcularRiscoFromPercent(avgGreen)}</strong></div>`;
  summarCard.innerHTML = html;
  bilheteContainer.appendChild(summarCard);

  // modal highlight
  let modalHtml = `<h3 style="margin:0 0 8px">üé´ Bilhete ‚Äî Destaque</h3>`;
  modalHtml += `<div class="meta">Odd Final: <strong>${oddTotal.toFixed(2)}</strong> ‚Ä¢ % Green M√©dio: <strong>${avgGreen.toFixed(1)}%</strong> ‚Ä¢ Risco: <strong>${calcularRiscoFromPercent(avgGreen)}</strong></div>`;
  modalHtml += '<div style="margin-top:12px">';
  chosen.forEach((p,i)=>{
    modalHtml += `<div style="display:flex;justify-content:space-between;padding:12px;border-radius:10px;background:linear-gradient(90deg,#0b0b0b,#0f0f0f);margin-bottom:8px">
      <div style="flex:1"><strong>${p.jogo}</strong><div class="meta">${p.mercado}</div></div>
      <div style="text-align:right"><div style="font-weight:700">${p.odd.toFixed(2)}</div><div class="meta">${p.percent}%</div></div>
    </div>`;
  });
  modalHtml += '</div>';
  modalHtml += `<div style="margin-top:10px;text-align:right"><button id="modalCopy" class="btn">üìã Copiar</button> <button id="modalClose" class="btn">Fechar</button></div>`;
  modalBilheteInner.innerHTML = modalHtml;

  bilheteModal.classList.add('show');
  bilheteModal.setAttribute('aria-hidden','false');

  document.getElementById('modalClose').addEventListener('click', ()=>{ bilheteModal.classList.remove('show'); bilheteModal.setAttribute('aria-hidden','true'); });
  document.getElementById('modalCopy').addEventListener('click', ()=>{
    let txt = `Bilhete (${chosen.length} jogos) ‚Äî Odd final: ${oddTotal.toFixed(2)} ‚Äî % Green m√©dio: ${avgGreen.toFixed(1)}%\n\n`;
    chosen.forEach((p,i)=> txt += `${i+1}. ${p.jogo} ‚Äî ${p.mercado} | Odd: ${p.odd} | %Green: ${p.percent}%\n`);
    navigator.clipboard.writeText(txt).then(()=> alert('Bilhete copiado!'));
  });
}

/* wire generate */
generateBtn.addEventListener('click', gerarBilhete);
closeModal.addEventListener('click', ()=>{ bilheteModal.classList.remove('show'); bilheteModal.setAttribute('aria-hidden','true'); });

/* ========== COPY / PDF / PIX ========= */
document.getElementById('copiarBtn').addEventListener('click', ()=>{
  const cards = Array.from(document.querySelectorAll('#bilheteContainer .card'));
  if(cards.length===0){ alert('Nenhum bilhete para copiar.'); return; }
  let text = '';
  cards.forEach(c => text += c.innerText + '\n' + '-'.repeat(40) + '\n');
  navigator.clipboard.writeText(text).then(()=> alert('Bilhete(s) copiado(s)!'));
});

document.getElementById('pdfBtn').addEventListener('click', ()=>{
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({unit:'pt', format:'a4'});
  const cards = Array.from(document.querySelectorAll('#bilheteContainer .card'));
  if(cards.length===0){ alert('Nenhum bilhete para salvar.'); return; }
  let y = 40;
  doc.setFontSize(12);
  cards.forEach(c=>{
    const lines = c.innerText.split('\n');
    lines.forEach(line=>{
      doc.text(line, 40, y);
      y += 16;
      if(y > 780){ doc.addPage(); y = 40; }
    });
    y += 8;
  });
  const nome = `bilhete-${new Date().toISOString().slice(0,19).replace(/[:T]/g,'-')}.pdf`;
  doc.save(nome);
});

document.getElementById('pixBtn').addEventListener('click', ()=>{
  navigator.clipboard.writeText('geradordebilhete@gmail.com').then(()=> alert('E-mail do Pix copiado!'));
});

/* ========== ESTAT√çSTICAS ========= */
const estatBtn = document.getElementById('estatBtn');
const estatModal = document.getElementById('estatModal');
const closeEstat = document.getElementById('closeEstat');
const estatContent = document.getElementById('estatContent');
estatBtn.addEventListener('click', ()=>{
  const totalPalpites = palpites.length;
  const mercados = {};
  const times = {};
  let oddsSum = 0;
  palpites.forEach(p=>{
    oddsSum += p.odd;
    mercados[p.mercado] = (mercados[p.mercado] || 0) + 1;
    const parts = p.jogo.split(' x ').map(s=>s.trim());
    parts.forEach(t => { if(!t) return; times[t] = (times[t]||0)+1; });
  });
  const oddAvg = (oddsSum/totalPalpites).toFixed(2);

  let html = `<table class="stats"><tr><th>Total de palpites</th><td>${totalPalpites}</td></tr><tr><th>Odd m√©dia</th><td>${oddAvg}</td></tr></table>`;
  html += `<h3 style="color:var(--accent);margin-top:12px">Principais mercados</h3><table class="stats"><tr><th>Mercado</th><th>Qtd</th></tr>`;
  Object.entries(mercados).sort((a,b)=>b[1]-a[1]).forEach(([m,c])=> html += `<tr><td>${m}</td><td>${c}</td></tr>`);
  html += `</table>`;
  html += `<h3 style="color:var(--accent);margin-top:12px">Times com mais palpites</h3><ul style="color:var(--muted)">`;
  Object.entries(times).sort((a,b)=>b[1]-a[1]).slice(0,10).forEach(([t,c])=> html += `<li>${t} ‚Äî ${c}</li>`);
  html += `</ul>`;
  estatContent.innerHTML = html;
  estatModal.style.display = 'block';
});
closeEstat.addEventListener('click', ()=> estatModal.style.display = 'none');
window.addEventListener('click', (e)=> { if(e.target === estatModal) estatModal.style.display = 'none'; });

/* ========== SIDEBAR BUTTONS ========= */
document.getElementById('menuBilhetes').addEventListener('click', ()=>{
  document.querySelectorAll('.menu button').forEach(b=>b.classList.remove('active'));
  document.getElementById('menuBilhetes').classList.add('active');
  window.scrollTo({top:0,behavior:'smooth'});
});
document.getElementById('menuEstat').addEventListener('click', ()=>{ document.getElementById('estatBtn').click(); });
document.getElementById('menuPix').addEventListener('click', ()=>{ document.getElementById('pixBtn').click(); });
document.getElementById('menuCopiar').addEventListener('click', ()=>{ document.getElementById('copiarBtn').click(); });
document.getElementById('menuPdf').addEventListener('click', ()=>{ document.getElementById('pdfBtn').click(); });

/* LOGOUT */
document.getElementById('menuLogout').addEventListener('click', ()=>{
  if(confirm('Deseja fazer logout?')) {
    localStorage.removeItem('loginCode');
    document.location.reload();
  }
});

/* Keep login across reload if valid */
(function initSavedLogin(){
  const saved = localStorage.getItem('loginCode');
  if(!saved) return;
  const user = loginCodes.find(c=>c.code === saved);
  if(user && (!user.usado || user.tipo==='adm')) {
    const overlay = document.getElementById('loginOverlay');
    if(overlay) overlay.style.display = 'none';
    // don't change used status here
  } else {
    localStorage.removeItem('loginCode');
  }
})();

/* Enter key to submit login */
loginInput.addEventListener('keypress', (e)=>{ if(e.key === 'Enter') loginBtn.click(); });

</script>

</body>
</html>