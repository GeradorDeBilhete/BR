<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>🎯 Gerador De Bilhete🎟️</title>

<!-- Manifest PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#00ff99">

<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');

  body {
    font-family: 'Poppins', sans-serif;
    background-color: #0b0b0b;
    color: #f1f1f1;
    margin: 0;
    padding: 0;
    text-align: center;
  }

  h1 {
    margin-top: 20px;
    color: #00ff99;
    letter-spacing: 1px;
  }

  .container {
    background-color: #1a1a1a;
    padding: 25px;
    border-radius: 12px;
    width: 90%;
    max-width: 700px;
    margin: 20px auto;
    box-shadow: 0 0 20px rgba(0, 255, 153, 0.2);
  }

  label, select, input {
    display: block;
    margin: 10px auto;
    text-align: left;
    width: 80%;
    color: #ddd;
  }

  .input-row {
    display: flex;
    justify-content: space-between;
    width: 80%;
    margin: 10px auto;
  }

  .input-row input {
    width: 48%;
    background: #2a2a2a;
    color: #fff;
    border: 1px solid #444;
    border-radius: 6px;
    padding: 8px;
    box-sizing: border-box;
  }

  button {
    background-color: #00ff99;
    border: none;
    color: #000;
    font-weight: bold;
    padding: 10px 20px;
    margin: 15px 5px;
    border-radius: 8px;
    cursor: pointer;
    transition: 0.2s;
  }

  button:hover {
    background-color: #00cc7a;
  }

  .markets, .esportes, .dias {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    margin: 10px 0;
  }

  .markets label, .esportes label, .dias label {
    display: flex;
    align-items: center;
    margin: 5px 10px;
  }

  .markets input, .esportes input, .dias input {
    margin-right: 5px;
  }

  .dias input:disabled + span {
    color: #888;
  }

  pre {
    text-align: left;
    background: #111;
    border: 1px solid #333;
    border-radius: 8px;
    padding: 15px;
    margin-top: 20px;
    white-space: pre-wrap;
    color: #d9d9d9;
    max-height: 350px;
    overflow-y: auto;
  }

  .estatisticas {
    text-align: left;
    margin-top: 20px;
    background: #111;
    padding: 15px;
    border-radius: 8px;
    border: 1px solid #333;
  }

  /* Card de doação Pix */
  .donate-card {
    background-color: #ffcc00;
    color: #000;
    padding: 12px 20px;
    border-radius: 10px;
    cursor: pointer;
    margin: 20px auto;
    width: fit-content;
    text-align: center;
    font-weight: bold;
    transition: 0.2s;
  }
  .donate-card:hover {
    background-color: #e6b800;
  }

  .stat-green { color: #00ff99; }
  .stat-yellow { color: #ffcc00; }
  .stat-red { color: #ff4d4d; }
</style>
</head>
<body>
<h1>🎯 Gerador De Bilhete🎟️</h1>

<div class="container">
  <p>Filtros de bilhete:</p>

  <label>Quantidade de jogos:
    <input id="qtd" type="number" min="1" value="3">
  </label>

  <div class="input-row">
    <input id="min" type="number" step="0.01" value="1.20" placeholder="Odd mínima">
    <input id="max" type="number" step="0.01" value="2.50" placeholder="Odd máxima">
  </div>

  <!-- Botão gerar bilhete no topo -->
  <button onclick="gerarBilhete()">🎟️ Gerar Bilhete</button>

  <p>Escolha os esportes:</p>
  <div class="esportes">
    <label><input type="checkbox" class="esporte" value="futebol" checked>Futebol</label>
    <label><input type="checkbox" class="esporte" value="basquete" checked>Basquete</label>
    <label><input type="checkbox" class="esporte" value="tenis" checked>Tênis</label>
  </div>

  <p>Escolha os mercados:</p>
  <div class="markets">
    <label><input type="checkbox" class="market" value="+1.5 gols" checked>+1.5 Gols</label>
    <label><input type="checkbox" class="market" value="+0.5 1T" checked>+0.5 1T</label>
    <label><input type="checkbox" class="market" value="vitória" checked>Vitória</label>
    <label><input type="checkbox" class="market" value="dupla chance" checked>Dupla Chance</label>
    <label><input type="checkbox" class="market" value="+0.5 gols casa" checked>+0.5 Gols Casa/Fora</label>
  </div>

  <p>Escolha o dia:</p>
  <div class="dias" id="diasContainer">
    <label><input type="radio" name="dia" value="Seg"><span>Seg</span></label>
    <label><input type="radio" name="dia" value="Ter"><span>Ter</span></label>
    <label><input type="radio" name="dia" value="Qua"><span>Qua</span></label>
    <label><input type="radio" name="dia" value="Qui"><span>Qui</span></label>
    <label><input type="radio" name="dia" value="Sex"><span>Sex</span></label>
    <label><input type="radio" name="dia" value="Sab"><span>Sab</span></label>
    <label><input type="radio" name="dia" value="Dom"><span>Dom</span></label>
  </div>

  <button onclick="copiarBilhete()">📋 Copiar Bilhete</button>
  <button onclick="baixarPDF()">💾 Baixar PDF</button>

  <pre id="saida">---</pre>

  <div class="estatisticas" id="estatisticas">
    <h3>📊 Estatísticas do Gerador</h3>
    <p id="estatTexto">Nenhum bilhete gerado ainda.</p>
  </div>

  <p style="text-align:left; font-size:13px; margin-top:20px;">
    🔹 GC: GREEN EM CASA<br>
    🔹 GF: GREEN FORA DE CASA<br>
    🔹 GG: ÚLTIMOS CONFRONTO DIRETO
  </p>

  <!-- Card de doação Pix -->
  <div class="donate-card" onclick="copiarPix()">
    💖 Ajude um pobre (dono do app)<br>
    <strong>Pix: geradordebilhete@gmail.com</strong>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
let bilhetesGerados = 0;

const palpites = [
    { jogo: "Flamengo x Palmeiras", mercado: "+1.5 gols", odd: 1.45, gc:"3/5", gf:"3/5", gg:"3/5", esporte:"futebol", dia:"Dom" },
    { jogo: "Mirassol x São Paulo", mercado: "+1.5 gols", odd: 1.50, gc:"9/10", gf:"3/5", gg:"11/12", esporte:"futebol", dia:"Dom" },
    { jogo: "Getafe x Real Madrid", mercado: "vitória", odd: 1.40, gc:"4V 1E", gf:"4V 1D", gg:"8/10", esporte:"futebol", dia:"Dom" },
    { jogo: "Celta de Vigo x Real Sociedad", mercado: "+0.5 gols casa", odd: 1.22, gc:"5/5", gf:"4/5", gg:"4/5", esporte:"futebol", dia:"Dom" },
    { jogo: "Como x Juventus", mercado: "+1.5 gols", odd: 1.40, gc:"10/10", gf:"4/5", gg:"4/4", esporte:"futebol", dia:"Dom" },
    { jogo: "Milan x Fiorentina", mercado: "vitória", odd: 1.55, gc:"4V 1D", gf:"4E 1V", gg:"2V 2D 1E", esporte:"futebol", dia:"Dom" }
];

window.addEventListener('DOMContentLoaded', () => {
    const diasDisponiveis = [...new Set(palpites.map(p => p.dia))];
    document.querySelectorAll('.dias input').forEach(input => {
      if (!diasDisponiveis.includes(input.value)) input.disabled = true;
      if(input.value === 'Sab' && !input.disabled) input.checked = true;
    });
});

// Gerar bilhete
function gerarBilhete() {
    const qtd = parseInt(document.getElementById("qtd").value);
    const oddMin = parseFloat(document.getElementById("min").value);
    const oddMax = parseFloat(document.getElementById("max").value);
    const mercadosSelecionados = Array.from(document.querySelectorAll(".market:checked")).map(m => m.value.toLowerCase());
    const esportesSelecionados = Array.from(document.querySelectorAll(".esporte:checked")).map(e => e.value.toLowerCase());
    const diaSelecionado = document.querySelector('input[name="dia"]:checked').value;

    let filtrados = palpites.filter(p => p.odd >= oddMin && p.odd <= oddMax)
                            .filter(p => mercadosSelecionados.includes(p.mercado.toLowerCase())
                                      && esportesSelecionados.includes(p.esporte.toLowerCase())
                                      && p.dia === diaSelecionado);

    if(filtrados.length === 0){
      document.getElementById("saida").textContent = `❌ Não há mais palpites disponíveis para o dia ${diaSelecionado}.`;
      return;
    }

    const sorteados = filtrados.sort(() => 0.5 - Math.random()).slice(0, qtd);
    bilhetesGerados++;

    let texto = "";
    let totalOdd = 1;
    const times = {}, acertosMercado = {}, acertosGC = 0, acertosGF = 0, acertosGG = 0;

    sorteados.forEach((p,i)=>{
        let gcClass = getColorStat(p.gc), gfClass = getColorStat(p.gf), ggClass = getColorStat(p.gg);
        texto += `🏆 ${i+1}. ${p.jogo}\n`;
        texto += `   Mercado: ${p.mercado}\n`;
        texto += `   Odd: ${p.odd}\n`;
        texto += `   GC: ${colorText(p.gc,gcClass)} | GF: ${colorText(p.gf,gfClass)} | GG: ${colorText(p.gg,ggClass)}\n`;
        texto += "-----------------------------------\n";
        totalOdd *= p.odd;

        // Estatísticas
        times[p.jogo.split(" x ")[0]] = (times[p.jogo.split(" x ")[0]]||0)+1;
        times[p.jogo.split(" x ")[1]] = (times[p.jogo.split(" x ")[1]]||0)+1;
        acertosMercado[p.mercado] = (acertosMercado[p.mercado]||0)+1;
    });

    texto += `\n💰 Odd total: ${totalOdd.toFixed(2)}`;
    document.getElementById("saida").innerHTML = texto;

    // Atualiza estatísticas
    let estatTexto = `Bilhetes gerados: ${bilhetesGerados}\n`;
    estatTexto += `Palpites gerados: ${sorteados.length}\n`;
    estatTexto += `Times diferentes: ${Object.keys(times).length}\n`;
    estatTexto += `Acertos por mercado: ${JSON.stringify(acertosMercado,null,2)}`;
    document.getElementById("estatTexto").textContent = estatTexto;
}

function getColorStat(stat){
    if(stat.includes("V") || parseInt(stat.split("/")[0])/parseInt(stat.split("/")[1])>=0.7) return "stat-green";
    if(stat.includes("E") || parseInt(stat.split("/")[0])/parseInt(stat.split("/")[1])>=0.5) return "stat-yellow";
    return "stat-red";
}

function colorText(text,className){ return `<span class="${className}">${text}</span>`; }

function copiarBilhete(){
    const texto = document.getElementById("saida").innerText;
    navigator.clipboard.writeText(texto);
    alert("Bilhete copiado para a área de transferência!");
}

function baixarPDF(){
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    const texto = document.getElementById("saida").innerText;
    doc.setFontSize(12);
    doc.text(texto,10,10);
    const data = new Date();
    const filename = `bilhete-${String(data.getDate()).padStart(2,'0')}-${String(data.getMonth()+1).padStart(2,'0')}-${data.getFullYear()}.pdf`;
    doc.save(filename);
}

// Copiar Pix
function copiarPix(){
    navigator.clipboard.writeText("geradordebilhete@gmail.com");
    alert("Pix copiado para área de transferência!");
}

// PWA - Service Worker
if('serviceWorker' in navigator){
    navigator.serviceWorker.register('sw.js')
    .then(()=>console.log('Service Worker registrado'))
    .catch(err=>console.log('Erro Service Worker:',err));
}
</script>
</body>
</html>