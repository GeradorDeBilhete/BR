<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>üéØ Gerador De Bilhete üéüÔ∏è <small>Beta</small></title>

<link rel="manifest" href="./manifest.json">
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#000;
  --panel:#0b0b0b;
  --muted:#bfbfbf;
  --accent:#00ff88;
  --accent-2:#00cc66;
  --card:#0f0f0f;
}
*{box-sizing:border-box}
body{margin:0;font-family:"Montserrat",system-ui,Arial,sans-serif;background:var(--bg);color:#f2f2f2;-webkit-font-smoothing:antialiased;}
header{text-align:center;padding:28px 16px 8px;}
h1{margin:0;color:var(--accent);font-size:20px;font-weight:700;letter-spacing:0.6px;text-shadow:0 0 8px rgba(0,255,136,0.08);}
.wrap{max-width:900px;margin:18px auto;padding:18px;background:var(--panel);border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,0.6);}
.row{display:flex;gap:12px;align-items:center;flex-wrap:wrap;justify-content:space-between;}
label.ch{display:flex;align-items:center;gap:8px;color:var(--muted);font-size:14px;}
.controls{padding:8px 0 6px;display:flex;flex-direction:column;gap:10px;}
.field{display:flex;gap:10px;align-items:center;flex-wrap:wrap;justify-content:space-between;}
select,input[type=number], .select-like{background:#0c0c0c;border:1px solid #171717;color:#f2f2f2;padding:10px;border-radius:8px;min-width:160px;}
.markets, .sports, .days{display:flex;gap:8px;flex-wrap:wrap;}
.chip{background:#101010;border:1px solid #161616;color:#ddd;padding:8px 10px;border-radius:10px;cursor:pointer;user-select:none;}
.chip.active{background:var(--accent);color:#000;transform:scale(1.03);box-shadow:0 6px 18px rgba(0,255,136,0.08);}
.actions{display:flex;gap:10px;flex-wrap:wrap;}
button.btn{background:var(--accent);color:#000;border:none;padding:10px 14px;border-radius:10px;font-weight:600;cursor:pointer;box-shadow:0 6px 18px rgba(0,255,136,0.06);}
button.ghost{background:transparent;border:1px solid #222;color:var(--muted);}
#bilheteContainer{margin-top:14px;display:flex;flex-direction:column;gap:12px;align-items:center;}
.card{background:var(--card);border:1px solid rgba(0,255,136,0.08);padding:12px;border-radius:10px;opacity:0;transform:translateY(14px);transition:all .35s cubic-bezier(.2,.9,.3,1);width:100%;max-width:720px;}
.card.show{opacity:1;transform:none;}
.card h3{margin:0;font-size:15px;color:#fff;}
.meta{font-size:13px;color:var(--muted);margin-top:6px;}
.stats-line{margin-top:8px;font-size:13px;}
.stat-green{color:var(--accent);}
.stat-yellow{color:#ffcc00;}
.stat-red{color:#ff4d4d;}
.legend{margin-top:14px;color:var(--muted);font-size:13px;line-height:1.5;}
.foot{margin-top:18px;color:#7a7a7a;font-size:13px;text-align:center;}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.85);z-index:60;padding:28px;overflow:auto;}
.modal .panel{max-width:900px;margin:20px auto;background:#070707;padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);}
.modal h2{margin:0 0 8px;color:var(--accent);}
table.stats{width:100%;border-collapse:collapse;margin-top:10px;color:var(--muted);font-size:14px;}
table.stats th, table.stats td{padding:8px;border-bottom:1px solid rgba(255,255,255,0.02);text-align:left;}
.small{font-size:13px;color:var(--muted);}
@media(max-width:720px){.row{flex-direction:column;align-items:stretch}.field{flex-direction:column;align-items:stretch}.markets,.sports,.days{justify-content:flex-start}}
</style>
</head>
<body>

<header>
  <h1>üéØ Gerador De Bilhete üéüÔ∏è <small style="font-size:12px;color:var(--muted)">Beta</small></h1>
</header>

<div class="wrap" role="main">
  <div class="controls">

    <!-- N√∫mero de jogos e odd -->
    <div class="row" style="margin-bottom:10px">
      <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
        <label class="small">Quantidade de jogos</label>
        <input id="qtd" type="number" min="1" value="3" style="width:84px">
        <label class="small">Odd m√≠n</label>
        <input id="minOdd" type="number" step="0.01" value="1.20" style="width:96px">
        <label class="small">Odd m√°x</label>
        <input id="maxOdd" type="number" step="0.01" value="2.50" style="width:96px">
      </div>
    </div>

    <!-- Bot√µes de a√ß√£o -->
    <div class="row" style="margin-bottom:10px">
      <button id="generateBtn" class="btn" style="flex:1.5">üé≤ Gerar Bilhete</button>
      <div class="actions" style="flex:1;justify-content:flex-end">
        <button id="estatBtn" class="btn">üìä Estat√≠sticas</button>
        <button id="copiarBtn" class="btn">üìã Copiar</button>
        <button id="pdfBtn" class="btn">üíæ PDF</button>
      </div>
    </div>

    <!-- Sele√ß√£o de esportes e dias -->
    <div class="field">
      <div>
        <div style="color:var(--muted);margin-bottom:6px">Escolher esporte</div>
        <div class="sports" id="sportsWrap"></div>
      </div>
      <div>
        <label class="small">Filtro de dia</label>
        <div class="days" id="daysWrap" style="margin-top:6px"></div>
      </div>
    </div>

    <!-- Mercados -->
    <div style="margin-top:8px">
      <div style="color:var(--muted);margin-bottom:6px">Mercados (selecion√°veis)</div>
      <div class="markets" id="marketsWrap"></div>
    </div>

    <!-- Somente futebol e Pix -->
    <div style="margin-top:12px;display:flex;gap:8px;align-items:center;flex-wrap:wrap">
      <label class="ch"><input id="onlyFootball" type="checkbox">Somente Futebol</label>
    </div>

  </div>

  <!-- Bilhetes -->
  <div id="bilheteContainer"></div>

  <div class="legend">
    üîπ <strong>GC:</strong> GREEN EM CASA &nbsp;|&nbsp;
    üîπ <strong>GF:</strong> GREEN FORA DE CASA &nbsp;|&nbsp;
    üîπ <strong>GG:</strong> √öLTIMOS CONFRONTOS DIRETOS
  </div>

  <div class="foot">
    <div style="margin-bottom:6px">Ajude um pobre dono do app: <strong>geradordebilhete@gmail.com</strong></div>
  </div>
</div>

<!-- Estat√≠sticas Modal -->
<div id="estatModal" class="modal" aria-hidden="true">
  <div class="panel">
    <button id="closeEstat" style="float:right;background:var(--accent);border:none;padding:8px 10px;border-radius:8px;cursor:pointer">Fechar</button>
    <h2>üìä Estat√≠sticas do Gerador</h2>
    <div id="estatContent" style="margin-top:8px"></div>
  </div>
</div>

<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
// Aqui entra todo o JS do seu app (palpites, gera√ß√£o, estat√≠sticas, c√≥digos, anima√ß√£o destaque etc.)
// Posso enviar o JS completo pronto no pr√≥ximo passo
</script>

<script>
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('./service-worker.js')
  .then(()=>console.log('Service Worker registrado'))
  .catch(err=>console.log('SW erro:', err));
}
</script>
<script>
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('./service-worker.js')
  .then(() => console.log('Service Worker registrado'))
  .catch(err => console.log('SW erro:', err));
}
</script>
<script>
/* ====================== CONFIGURA√á√ÉO DE C√ìDIGOS ====================== */
const codigos24h = Array.from({length:25},()=>Math.floor(Math.random()*900000+100000).toString());
const codigos30d = Array.from({length:25},()=>Math.floor(Math.random()*900000+100000).toString());
const codigoDono = "082111"; // 1 acesso
const usoCodigos = {}; // {codigo: {tipo: "24h"|"30d"|"adm", usado:true/false, expiracao:timestamp}}

let codigoAtivo = null; // c√≥digo usado atualmente
let expiracaoAtiva = null;

/* ====================== DADOS DE PALPITES ====================== */
const palpites = [
  {esporte:"Futebol", dia:"domingo", jogo:"Flamengo x Palmeiras", mercado:"+1.5 Gols", odd:1.45, gc:"3/5", gf:"3/5", gg:"3/5"},
  {esporte:"Futebol", dia:"domingo", jogo:"Mirassol x S√£o Paulo", mercado:"+1.5 Gols", odd:1.50, gc:"9/10", gf:"3/5", gg:"11/12"},
  {esporte:"Futebol", dia:"domingo", jogo:"Getafe x Real Madrid", mercado:"Vit√≥ria", odd:1.40, gc:"4V 1D", gf:"4V 1D", gg:"8/10"},
  {esporte:"Futebol", dia:"domingo", jogo:"Celta de Vigo x Real Sociedad", mercado:"+0.5 Gols Casa", odd:1.22, gc:"5/5", gf:"4/5", gg:"4/5"},
  {esporte:"Futebol", dia:"domingo", jogo:"Como x Juventus", mercado:"+1.5 Gols", odd:1.40, gc:"10/10", gf:"4/5", gg:"4/4"},
  {esporte:"Futebol", dia:"domingo", jogo:"Milan x Fiorentina", mercado:"Vit√≥ria", odd:1.55, gc:"4V 1D", gf:"4E 1V", gg:"2V 2D 1E"}
];

/* ====================== CONFIGURA√á√ïES ====================== */
const marketsList = [
  "Vit√≥ria","Dupla Chance","+0.5 Gols 1T","+0.5 Gols Casa","+0.5 Gols Fora","+1.5 Gols","Ambas Marcam","Over 2.5","Under 3.5","Handicap"
];

const sportsList = [...new Set(palpites.map(p=>p.esporte))].sort();
const daysList = ["segunda","ter√ßa","quarta","quinta","sexta","s√°bado","domingo"];

/* ====================== ELEMENTOS ====================== */
const bilheteContainer = document.getElementById("bilheteContainer");
const marketsWrap = document.getElementById("marketsWrap");
const sportsWrap = document.getElementById("sportsWrap");
const daysWrap = document.getElementById("daysWrap");
const generateBtn = document.getElementById("generateBtn");
const estatBtn = document.getElementById("estatBtn");
const estatModal = document.getElementById("estatModal");
const closeEstat = document.getElementById("closeEstat");
const estatContent = document.getElementById("estatContent");
const copiarBtn = document.getElementById("copiarBtn");
const pdfBtn = document.getElementById("pdfBtn");
const onlyFootball = document.getElementById("onlyFootball");

/* ====================== FUN√á√ïES DE UI ====================== */
function mkChip(text, container, initial=true){
  const el = document.createElement("div");
  el.className = "chip" + (initial?" active":"");
  el.textContent = text;
  el.dataset.value = text;
  el.addEventListener("click",()=>el.classList.toggle("active"));
  container.appendChild(el);
  return el;
}

marketsList.forEach(m=>mkChip(m, marketsWrap,true));
sportsList.forEach(s=>mkChip(s, sportsWrap,true));
daysList.forEach(d=>{
  const el = document.createElement("div");
  el.className = "chip"+(d==="domingo"?" active":"");
  el.textContent = d[0].toUpperCase()+d.slice(1);
  el.dataset.value=d;
  el.addEventListener("click",()=>{
    document.querySelectorAll('#daysWrap .chip').forEach(c=>c.classList.remove('active'));
    el.classList.add('active');
  });
  daysWrap.appendChild(el);
});

/* ====================== FUN√á√ÉO PERCENTUAL ====================== */
function parseFractionPercent(stat){
  try{
    if(!stat||stat.trim()==='-') return null;
    if(stat.includes('/')){
      const parts = stat.split('/').map(s=>parseInt(s.replace(/\D/g,'')));
      if(parts.length>=2 && parts[1]>0) return Math.round(parts[0]/parts[1]*100);
    }
    const winMatch = stat.match(/(\d+)\s*V/i);
    const nums = stat.match(/\d+/g);
    if(nums && nums.length>0){
      const total = nums.map(n=>parseInt(n,10)).reduce((a,b)=>a+b,0);
      let wins = 0;
      if(winMatch) wins = parseInt(winMatch[1],10);
      else{
        const lastV = stat.match(/(\d+)\s*[Vv]/);
        if(lastV) wins=parseInt(lastV[1],10);
        else wins=parseInt(nums[0],10);
      }
      if(total>0) return Math.round((wins/total)*100);
    }
  }catch(e){}
  return null;
}

/* ====================== LOGIN C√ìDIGO ====================== */
function promptLogin(){
  const codigo = prompt("Digite seu c√≥digo de acesso:");
  if(!codigo) return false;

  if(codigo===codigoDono){
    if(usoCodigos[codigo] && usoCodigos[codigo].usado){
      alert("C√≥digo de dono j√° usado!");
      return false;
    }
    usoCodigos[codigo]={tipo:"adm",usado:true,expiracao:null};
    codigoAtivo=codigo; expiracaoAtiva=null;
    alert("Bem-vindo, dono! Acesso concedido.");
    return true;
  }

  let tipo=null;
  if(codigos24h.includes(codigo)) tipo="24h";
  else if(codigos30d.includes(codigo)) tipo="30d";
  if(!tipo){ alert("C√≥digo inv√°lido!"); return false; }

  if(usoCodigos[codigo] && usoCodigos[codigo].usado){alert("C√≥digo j√° usado!");return false;}

  usoCodigos[codigo]={tipo:tipo,usado:true,expiracao:(tipo==="24h"?Date.now()+24*3600*1000:Date.now()+30*24*3600*1000)};
  codigoAtivo=codigo; expiracaoAtiva=usoCodigos[codigo].expiracao;
  const diasRest = tipo==="24h"?1:30;
  alert(`C√≥digo aceito! Validade: ${diasRest} dias.`);
  return true;
}

/* Verifica expira√ß√£o */
function checkCodigo(){
  if(!codigoAtivo) return false;
  if(usoCodigos[codigoAtivo] && usoCodigos[codigoAtivo].expiracao){
    if(Date.now()>usoCodigos[codigoAtivo].expiracao){
      alert("Seu c√≥digo expirou! Insira outro c√≥digo.");
      codigoAtivo=null; expiracaoAtiva=null;
      return false;
    }
  }
  return true;
}

/* ====================== GERAR BILHETE ====================== */
function gerarBilhete(){
  if(!checkCodigo()){ bilheteContainer.innerHTML='<div class="card show"><div class="meta">‚ö†Ô∏è Insira c√≥digo v√°lido antes de gerar bilhete.</div></div>'; return; }

  const qtd = Math.max(1, parseInt(document.getElementById("qtd").value||3));
  const minOdd = parseFloat(document.getElementById("minOdd").value||1.0);
  const maxOdd = parseFloat(document.getElementById("maxOdd").value||999);
  const selectedMarkets = Array.from(document.querySelectorAll('#marketsWrap .chip.active')).map(n=>n.dataset.value.toLowerCase());
  const selectedSports = Array.from(document.querySelectorAll('#sportsWrap .chip.active')).map(n=>n.dataset.value.toLowerCase());
  const dayEl = document.querySelector('#daysWrap .chip.active');
  const selectedDay = dayEl?dayEl.dataset.value:"domingo";
  const onlyF = onlyFootball.checked;

  let filtered = palpites.filter(p=>{
    const pMarket = String(p.mercado||'').toLowerCase();
    const pSport = String(p.esporte||'').toLowerCase();
    const pDay = String(p.dia||'').toLowerCase();
    const oddOK = (p.odd >= minOdd && p.odd <= maxOdd);
    const marketOK = selectedMarkets.includes(pMarket);
    const sportByUser = onlyF? (pSport==='futebol'):selectedSports.includes(pSport);
    const dayOK = (selectedDay==='todos'||pDay===selectedDay);
    return oddOK && marketOK && sportByUser && dayOK;
  });

  if(filtered.length===0){ bilheteContainer.innerHTML='<div class="card show"><div class="meta">‚ùå Nenhum jogo encontrado para os filtros.</div></div>'; return; }

  const shuffled = filtered.sort(()=>0.5-Math.random()).slice(0,qtd);

  bilheteContainer.innerHTML="";
  const bilheteObj={id:Date.now(), jogos:shuffled};
  const card = document.createElement("div"); card.className="card"; 
  card.innerHTML='<h3>üéüÔ∏è Bilhete Gerado</h3>'+shuffled.map(j=>`
    <div class="meta">${j.jogo} | ${j.mercado} | Odd: ${j.odd}</div>
  `).join('')+`<div class="stats-line small">Dias restantes: ${expiracaoAtiva?Math.ceil((expiracaoAtiva-Date.now())/(24*3600*1000)): '‚àû'}</div>`;
  bilheteContainer.appendChild(card);
  setTimeout(()=>card.classList.add("show"),10);
}

/* ====================== ESTAT√çSTICAS ====================== */
function mostrarEstat(){
  if(!bilheteContainer.children.length){ alert("Nenhum bilhete gerado ainda."); return; }
  estatContent.innerHTML="";
  const cards = bilheteContainer.querySelectorAll(".card");
  cards.forEach((c,i)=>{
    const jogos = Array.from(c.querySelectorAll(".meta")).map(el=>el.textContent);
    const table = document.createElement("table"); table.className="stats";
    table.innerHTML='<tr><th>Jogo</th><th>Odd</th><th>Mercado</th></tr>';
    jogos.forEach(j=>{
      const parts = j.split('|').map(s=>s.trim());
      table.innerHTML+=`<tr><td>${parts[0]}</td><td>${parts[2]||''}</td><td>${parts[1]}</td></tr>`;
    });
    estatContent.appendChild(table);
  });
  estatModal.style.display="block";
}

/* ====================== COPIAR PDF ====================== */
copiarBtn.addEventListener("click",()=>{
  let text = Array.from(document.querySelectorAll("#bilheteContainer .card .meta")).map(el=>el.textContent).join("\n");
  navigator.clipboard.writeText(text).then(()=>alert("Bilhete copiado!"));
});

pdfBtn.addEventListener("click",()=>{
  if(typeof jspdf==='undefined'){ alert("PDF n√£o carregado!"); return; }
  const doc = new jspdf.jsPDF();
  let y=10;
  Array.from(document.querySelectorAll("#bilheteContainer .card .meta")).forEach(el=>{
    doc.text(el.textContent,10,y); y+=10;
  });
  doc.save("bilhete.pdf");
});

/* ====================== EVENTOS ====================== */
generateBtn.addEventListener("click",gerarBilhete);
estatBtn.addEventListener("click",mostrarEstat);
closeEstat.addEventListener("click",()=>estatModal.style.display="none");

/* ====================== LOGIN INICIAL ====================== */
promptLogin();

</script>
</body>
</html>