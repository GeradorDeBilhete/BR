<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>üéØ Gerador de Bilhete üéüÔ∏è</title>

<!-- Fonte -->
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet">

<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
  :root{
    --bg:#000000;
    --panel:#0b0b0b;
    --muted:#bfbfbf;
    --accent:#00ff88;
    --accent-2:#00cc66;
    --card:#0f0f0f;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:"Montserrat",system-ui,Arial,sans-serif;
    background:var(--bg);
    color:#f2f2f2;
    -webkit-font-smoothing:antialiased;
  }
  header{
    text-align:center;
    padding:28px 16px 8px;
  }
  h1{margin:0;color:var(--accent);font-size:20px;font-weight:700;letter-spacing:0.6px;text-shadow:0 0 8px rgba(0,255,136,0.08);}
  .wrap{
    max-width:900px;margin:18px auto;padding:18px;background:var(--panel);border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,0.6);
  }
  .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap;justify-content:space-between;}
  label.ch{
    display:flex;align-items:center;gap:8px;color:var(--muted);font-size:14px;
  }
  .controls{
    padding:8px 0 6px;
    display:flex;flex-direction:column;gap:10px;
  }
  .field{
    display:flex;gap:10px;align-items:center;flex-wrap:wrap;justify-content:space-between;
  }
  select,input[type=number], .select-like {
    background:#0c0c0c;border:1px solid #171717;color:#f2f2f2;padding:10px;border-radius:8px;min-width:160px;
  }
  .markets, .sports, .days {
    display:flex;gap:8px;flex-wrap:wrap;
  }
  .chip{
    background:#101010;border:1px solid #161616;color:#ddd;padding:8px 10px;border-radius:10px;cursor:pointer;user-select:none;
  }
  .chip.active{background:var(--accent);color:#000;transform:scale(1.03);box-shadow:0 6px 18px rgba(0,255,136,0.08);}
  .actions{display:flex;gap:10px;flex-wrap:wrap;}
  button.btn{
    background:var(--accent);color:#000;border:none;padding:10px 14px;border-radius:10px;font-weight:600;cursor:pointer;
    box-shadow:0 6px 18px rgba(0,255,136,0.06);
  }
  button.ghost{background:transparent;border:1px solid #222;color:var(--muted);}
  #bilheteContainer{margin-top:14px;display:flex;flex-direction:column;gap:12px}
  .card{
    background:var(--card);border:1px solid rgba(0,255,136,0.08);padding:12px;border-radius:10px;opacity:0;transform:translateY(14px);
    transition:all .35s cubic-bezier(.2,.9,.3,1);
  }
  .card.show{opacity:1;transform:none;}
  .card h3{margin:0;font-size:15px;color:#fff}
  .meta{font-size:13px;color:var(--muted);margin-top:6px}
  .stats-line{margin-top:8px;font-size:13px}
  .stat-green{color:var(--accent)}
  .stat-yellow{color:#ffcc00}
  .stat-red{color:#ff4d4d}
  .legend{margin-top:14px;color:var(--muted);font-size:13px;line-height:1.5}
  .foot{margin-top:18px;color:#7a7a7a;font-size:13px;text-align:center}
  /* Modal */
  .modal{
    display:none;position:fixed;inset:0;background:rgba(0,0,0,0.85);z-index:60;padding:28px;overflow:auto;
  }
  .modal .panel{max-width:900px;margin:20px auto;background:#070707;padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
  .modal h2{margin:0 0 8px;color:var(--accent)}
  table.stats{width:100%;border-collapse:collapse;margin-top:10px;color:var(--muted);font-size:14px}
  table.stats th, table.stats td{padding:8px;border-bottom:1px solid rgba(255,255,255,0.02);text-align:left}
  .small{font-size:13px;color:var(--muted)}
  @media(max-width:720px){ .row{flex-direction:column;align-items:stretch} .field{flex-direction:column;align-items:stretch} .markets,.sports,.days{justify-content:flex-start} }
</style>
</head>
<body>

<header>
  <h1>üéØ Gerador de Bilhete üéüÔ∏è</h1>
</header>

<div class="wrap" role="main">

  <div class="controls">

    <div class="row">
      <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
        <label class="small">Quantidade de jogos</label>
        <input id="qtd" type="number" min="1" value="3" style="width:84px">
        <label class="small">Odd m√≠n</label>
        <input id="minOdd" type="number" step="0.01" value="1.20" style="width:96px">
        <label class="small">Odd m√°x</label>
        <input id="maxOdd" type="number" step="0.01" value="2.50" style="width:96px">
      </div>

      <div class="actions">
        <button id="estatBtn" class="btn">üìä Estat√≠sticas</button>
        <button id="copiarBtn" class="btn">üìã Copiar</button>
        <button id="pdfBtn" class="btn">üíæ PDF</button>
      </div>
    </div>

    <!-- esporte selector: multi via chips + quick "apenas futebol" -->
    <div class="field">
      <div>
        <div style="color:var(--muted);margin-bottom:6px">Escolher esporte</div>
        <div class="sports" id="sportsWrap">
          <!-- chips gerados via JS -->
        </div>
      </div>

      <div>
        <label class="small">Filtro de dia</label>
        <div class="days" id="daysWrap" style="margin-top:6px"></div>
      </div>
    </div>

    <div>
      <div style="color:var(--muted);margin-bottom:6px">Mercados (selecion√°veis)</div>
      <div class="markets" id="marketsWrap"></div>
    </div>

    <div style="margin-top:8px;display:flex;gap:8px;align-items:center;flex-wrap:wrap">
      <button id="generateBtn" class="btn">üé≤ Gerar Bilhete</button>
      <label class="ch" style="margin-left:6px"><input id="onlyFootball" type="checkbox">Somente Futebol</label>
    </div>

  </div>

  <div id="bilheteContainer"></div>

  <div class="legend">
    üîπ <strong>GC:</strong> GREEN EM CASA &nbsp;|&nbsp;
    üîπ <strong>GF:</strong> GREEN FORA DE CASA &nbsp;|&nbsp;
    üîπ <strong>GG:</strong> √öLTIMOS CONFRONTOS DIRETOS
  </div>

  <div class="foot">Desenvolvido por Kawan ‚Ä¢ Tema preto premium</div>
</div>

<!-- Estat√≠sticas Modal -->
<div id="estatModal" class="modal" aria-hidden="true">
  <div class="panel">
    <button id="closeEstat" style="float:right;background:var(--accent);border:none;padding:8px 10px;border-radius:8px;cursor:pointer">Fechar</button>
    <h2>üìä Estat√≠sticas do Gerador</h2>
    <div id="estatContent" style="margin-top:8px"></div>
  </div>
</div>

<script>
/* ============== DADOS INICIAIS ============== 
   Cada palpite agora tem: esporte, jogo, mercado, odd, gc/gf/gg (strings), dia (lowercase weekday)
   Voc√™ disse que as listas que vai adicionar t√™m dia ‚Äî atualize esse campo quando adicionar novos palpites.
*/
const palpites = [
  // Futebol - domingo (exemplo)
  {esporte:"Futebol", dia:"domingo", jogo:"Flamengo x Palmeiras", mercado:"+1.5 Gols", odd:1.45, gc:"3/5", gf:"3/5", gg:"3/5"},
  {esporte:"Futebol", dia:"domingo", jogo:"Mirassol x S√£o Paulo", mercado:"+1.5 Gols", odd:1.50, gc:"9/10", gf:"3/5", gg:"11/12"},
  {esporte:"Futebol", dia:"domingo", jogo:"Getafe x Real Madrid", mercado:"Vit√≥ria", odd:1.40, gc:"4V 1D", gf:"4V 1D", gg:"8/10"},
  {esporte:"Futebol", dia:"domingo", jogo:"Celta de Vigo x Real Sociedad", mercado:"+0.5 Gols Casa", odd:1.22, gc:"5/5", gf:"4/5", gg:"4/5"},
  {esporte:"Futebol", dia:"domingo", jogo:"Como x Juventus", mercado:"+1.5 Gols", odd:1.40, gc:"10/10", gf:"4/5", gg:"4/4"},
  {esporte:"Futebol", dia:"domingo", jogo:"Milan x Fiorentina", mercado:"Vit√≥ria", odd:1.55, gc:"4V 1D", gf:"4E 1V", gg:"2V 2D 1E"},

  // Basquete - domingo (exemplo)
  {esporte:"Basquete", dia:"domingo", jogo:"Lakers x Warriors", mercado:"Vit√≥ria", odd:1.80, gc:"4/5", gf:"3/5", gg:"3/5"},
  {esporte:"Basquete", dia:"domingo", jogo:"Celtics x Bulls", mercado:"Vit√≥ria", odd:1.60, gc:"8/10", gf:"4/10", gg:"7/10"},
  {esporte:"Basquete", dia:"domingo", jogo:"Heat x Knicks", mercado:"Vit√≥ria", odd:1.90, gc:"6/10", gf:"7/10", gg:"6/10"},

  // T√™nis - domingo (exemplo)
  {esporte:"T√™nis", dia:"domingo", jogo:"Djokovic x Alcaraz", mercado:"Vit√≥ria", odd:1.65, gc:"7/10", gf:"-", gg:"3/5"},
  {esporte:"T√™nis", dia:"domingo", jogo:"Nadal x Medvedev", mercado:"Vit√≥ria", odd:1.70, gc:"8/10", gf:"-", gg:"4/6"},
  {esporte:"T√™nis", dia:"domingo", jogo:"Sinner x Rune", mercado:"Vit√≥ria", odd:1.55, gc:"6/10", gf:"-", gg:"5/8"}
];

/* ============== CONFIGS E ELEMENTOS ============== */
const marketsList = [
  "Vit√≥ria",
  "Dupla Chance",
  "+0.5 Gols 1T",
  "+0.5 Gols Casa",
  "+0.5 Gols Fora",
  "+1.5 Gols",
  "Ambas Marcam",
  "Over 2.5",
  "Under 3.5",
  "Handicap"
];

const sportsList = [...new Set(palpites.map(p=>p.esporte))].sort();
const daysList = ["segunda","ter√ßa","quarta","quinta","sexta","s√°bado","domingo"];

const bilheteContainer = document.getElementById("bilheteContainer");
const marketsWrap = document.getElementById("marketsWrap");
const sportsWrap = document.getElementById("sportsWrap");
const daysWrap = document.getElementById("daysWrap");
const generateBtn = document.getElementById("generateBtn");
const estatBtn = document.getElementById("estatBtn");
const estatModal = document.getElementById("estatModal");
const closeEstat = document.getElementById("closeEstat");
const estatContent = document.getElementById("estatContent");
const copiarBtn = document.getElementById("copiarBtn");
const pdfBtn = document.getElementById("pdfBtn");
const onlyFootball = document.getElementById("onlyFootball");

/* ============== RENDER UI (chips) ============== */
function mkChip(text, container, initial=true){
  const el = document.createElement("div");
  el.className = "chip" + (initial ? " active" : "");
  el.textContent = text;
  el.dataset.value = text;
  el.addEventListener("click", ()=> el.classList.toggle("active"));
  container.appendChild(el);
  return el;
}

marketsList.forEach(m => mkChip(m, marketsWrap, true));
sportsList.forEach(s => mkChip(s, sportsWrap, true));
daysList.forEach(d => {
  const el = document.createElement("div");
  el.className = "chip" + (d==="domingo" ? " active" : "");
  el.textContent = d[0].toUpperCase() + d.slice(1);
  el.dataset.value = d;
  el.addEventListener("click", ()=>{
    // exclusividade entre dias: apenas 1 ativo
    document.querySelectorAll('#daysWrap .chip').forEach(c=>c.classList.remove('active'));
    el.classList.add('active');
  });
  daysWrap.appendChild(el);
});

/* ============== UTILIDADES DE PARSING ============== */
function parseFractionPercent(stat){
  // stat like "3/5" -> 60
  try{
    if(!stat || stat.trim()==='-' ) return null;
    if(stat.includes('/')){
      const parts = stat.split('/').map(s=>parseInt(s.replace(/\D/g,'')));
      if(parts.length>=2 && parts[1]>0) return Math.round(parts[0]/parts[1]*100);
    }
    // patterns like "4V 1D" or "4E 1V"
    const winMatch = stat.match(/(\d+)\s*V/i);
    const nums = stat.match(/\d+/g);
    if(nums && nums.length>0){
      const total = nums.map(n=>parseInt(n,10)).reduce((a,b)=>a+b,0);
      let wins = 0;
      if(winMatch) wins = parseInt(winMatch[1],10);
      else {
        // fallback: if pattern like "4E 1V" maybe take last number before V
        const lastV = stat.match(/(\d+)\s*[Vv]/);
        if(lastV) wins = parseInt(lastV[1],10);
        else wins = parseInt(nums[0],10); // fallback: first number as "successes"
      }
      if(total>0) return Math.round((wins/total)*100);
    }
  }catch(e){}
  return null;
}

/* ============== GERAR BILHETE ============== */
function gerarBilhete(){
  // ler controles
  const qtd = Math.max(1, parseInt(document.getElementById("qtd").value||3));
  const minOdd = parseFloat(document.getElementById("minOdd").value||1.0);
  const maxOdd = parseFloat(document.getElementById("maxOdd").value||999);
  const selectedMarkets = Array.from(document.querySelectorAll('#marketsWrap .chip.active')).map(n=>n.dataset.value.toLowerCase());
  const selectedSports = Array.from(document.querySelectorAll('#sportsWrap .chip.active')).map(n=>n.dataset.value.toLowerCase());
  const dayEl = document.querySelector('#daysWrap .chip.active');
  const selectedDay = dayEl ? dayEl.dataset.value : "domingo";
  const onlyF = onlyFootball.checked;

  // filtro por dia, esporte, mercado e odd
  let filtered = palpites.filter(p=>{
    const pMarket = String(p.mercado||'').toLowerCase();
    const pSport = String(p.esporte||'').toLowerCase();
    const pDay = String(p.dia||'').toLowerCase();
    const oddOK = (p.odd >= minOdd && p.odd <= maxOdd);
    const marketOK = selectedMarkets.includes(pMarket);
    const sportByUser = onlyF ? (pSport === 'futebol') : selectedSports.includes(pSport);
    const dayOK = (selectedDay === 'todos' || pDay === selectedDay);
    return oddOK && marketOK && sportByUser && dayOK;
  });

  if(filtered.length === 0){
    bilheteContainer.innerHTML = `<div class="card show"><div class="meta">‚ùå Nenhum jogo encontrado com esses filtros (dia/esporte/market/odd).</div></div>`;
    return;
  }

  // embaralhar e selecionar qtd
  const shuffled = filtered.sort(()=>0.5 - Math.random()).slice(0, qtd);

  // render cards sequenciais e salvar bilhete como grupo
  bilheteContainer.innerHTML = "";
  const bilheteObj = { timestamp: new Date().toISOString(), items: [] };
  let totalOdd = 1;

  shuffled.forEach((p,i)=>{
    totalOdd *= p.odd;
    const card = document.createElement('div');
    card.className = 'card';
    // percentuais
    const gcPct = parseFractionPercent(p.gc);
    const gfPct = parseFractionPercent(p.gf);
    const ggPct = parseFractionPercent(p.gg);
    const gcText = (gcPct===null? (p.gc || '-') : `${p.gc} (${gcPct}%)`);
    const gfText = (gfPct===null? (p.gf || '-') : `${p.gf} (${gfPct}%)`);
    const ggText = (ggPct===null? (p.gg || '-') : `${p.gg} (${ggPct}%)`);
    const gcClass = gcPct>=70 ? 'stat-green' : (gcPct>=50 ? 'stat-yellow' : 'stat-red');
    const gfClass = gfPct>=70 ? 'stat-green' : (gfPct>=50 ? 'stat-yellow' : 'stat-red');
    const ggClass = ggPct>=70 ? 'stat-green' : (ggPct>=50 ? 'stat-yellow' : 'stat-red');

    // chanceGreen average (ignore nulls by using only available values)
    const avail = [];
    if(typeof gcPct === 'number') avail.push(gcPct);
    if(typeof gfPct === 'number') avail.push(gfPct);
    if(typeof ggPct === 'number') avail.push(ggPct);
    const chanceGreen = avail.length ? Math.round(avail.reduce((a,b)=>a+b,0)/avail.length) : 0;
    const chanceClass = chanceGreen>=70 ? 'stat-green' : (chanceGreen>=50 ? 'stat-yellow' : 'stat-red');

    card.innerHTML = `
      <h3>üèÜ ${i+1}. [${p.esporte}] ${p.jogo}</h3>
      <div class="meta">${p.mercado} ‚Ä¢ Odd: <strong>${p.odd.toFixed(2)}</strong> ‚Ä¢ Dia: ${p.dia[0].toUpperCase()+p.dia.slice(1)}</div>
      <div class="stats-line">
        GC: <span class="${gcClass}">${gcText}</span> &nbsp; | &nbsp;
        GF: <span class="${gfClass}">${gfText}</span> &nbsp; | &nbsp;
        GG: <span class="${ggClass}">${ggText}</span>
      </div>
      <div class="stats-line" style="margin-top:8px">üîπ Chance de green: <span class="${chanceClass}">${chanceGreen}%</span></div>
    `;
    bilheteContainer.appendChild(card);
    // show animation sequential
    setTimeout(()=>card.classList.add('show'), i*200);

    // preparar item para historico
    bilheteObj.items.push({
      esporte: p.esporte,
      jogo: p.jogo,
      mercado: p.mercado,
      odd: p.odd,
      gc: p.gc || '-',
      gf: p.gf || '-',
      gg: p.gg || '-',
      green: chanceGreen,
      dia: p.dia
    });
  });

  // mostrar odd total
  const footer = document.createElement('div');
  footer.className = 'card show';
  footer.style.padding = '12px';
  footer.innerHTML = `<div class="meta"><strong>üí∞ Odd total:</strong> ${totalOdd.toFixed(2)}</div>`;
  setTimeout(()=>footer.classList.add('show'), shuffled.length*200);
  bilheteContainer.appendChild(footer);

  // salvar bilhete no localStorage (array de bilhetes)
  const historico = JSON.parse(localStorage.getItem('historicoBilhetes')||'[]');
  historico.push(bilheteObj);
  localStorage.setItem('historicoBilhetes', JSON.stringify(historico));
}

/* ============== COPIAR / PDF ============== */
copiarBtn.addEventListener('click', ()=>{
  const cards = Array.from(document.querySelectorAll('.card'));
  if(cards.length===0){ alert('Nenhum bilhete para copiar.'); return; }
  let text = '';
  cards.forEach(c => text += c.innerText + '\n' + '-'.repeat(40) + '\n');
  navigator.clipboard.writeText(text).then(()=> alert('Bilhete copiado!'));
});

pdfBtn.addEventListener('click', ()=>{
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({unit:'pt', format:'a4'});
  const cards = Array.from(document.querySelectorAll('.card'));
  if(cards.length===0){ alert('Nenhum bilhete para salvar.'); return; }
  let y = 40;
  doc.setFontSize(12);
  cards.forEach(c=>{
    const lines = c.innerText.split('\n');
    lines.forEach(line => {
      doc.text(line, 40, y);
      y += 16;
      if(y > 780){ doc.addPage(); y = 40; }
    });
    y += 8;
  });
  const nome = `bilhete-${new Date().toISOString().slice(0,19).replace(/[:T]/g,'-')}.pdf`;
  doc.save(nome);
});

/* ============== ESTAT√çSTICAS ============== */
estatBtn.addEventListener('click', ()=>{
  const historico = JSON.parse(localStorage.getItem('historicoBilhetes')||'[]');
  // se nenhum bilhete
  if(!historico.length){
    estatContent.innerHTML = `<div class="small">Nenhum bilhete gerado ainda.</div>`;
    estatModal.style.display = 'block';
    return;
  }

  // c√°lculos
  const bilhetesGerados = historico.length;
  const palpitesGerados = historico.reduce((s,b)=> s + (b.items ? b.items.length : 0), 0);
  const timesMap = {}; // nome -> count
  const marketMap = {}; // mercado -> {total, acertos}
  const sportMap = {}; // esporte -> {total, acertos}
  let acertos = 0, erros = 0;

  historico.forEach(b => {
    (b.items||[]).forEach(item => {
      // times
      const parts = item.jogo.split(' x ').map(s=>s.trim());
      parts.forEach(t => {
        if(!t) return;
        timesMap[t] = (timesMap[t]||0) + 1;
      });
      // market
      const m = item.mercado || 'Outro';
      marketMap[m] = marketMap[m] || {total:0, acertos:0};
      marketMap[m].total += 1;
      // sport
      const s = item.esporte || 'Outro';
      sportMap[s] = sportMap[s] || {total:0, acertos:0};
      sportMap[s].total += 1;
      // acerto?
      if(typeof item.green === 'number' && item.green >= 50){
        acertos += 1;
        marketMap[m].acertos += 1;
        sportMap[s].acertos += 1;
      } else {
        erros += 1;
      }
    });
  });

  const timesDifferent = Object.keys(timesMap).length;
  // top teams sorted
  const teamsSorted = Object.entries(timesMap).sort((a,b)=>b[1]-a[1]).slice(0,10);

  // build html
  let html = '';
  html += `<table class="stats"><tr><th>Bilhetes gerados</th><td>${bilhetesGerados}</td></tr>`;
  html += `<tr><th>Palpites gerados</th><td>${palpitesGerados}</td></tr>`;
  html += `<tr><th>Times diferentes</th><td>${timesDifferent}</td></tr>`;
  html += `<tr><th>Total de acertos</th><td>${acertos}</td></tr>`;
  html += `<tr><th>Total de erros</th><td>${erros}</td></tr></table>`;

  html += `<h3 style="color:var(--accent);margin-top:12px">Times com mais palpites</h3>`;
  html += `<ul style="color:var(--muted);margin-top:8px">` + teamsSorted.map(([t,c])=>`<li>${t} ‚Äî ${c}</li>`).join('') + `</ul>`;

  html += `<h3 style="color:var(--accent);margin-top:12px">Acertos por mercado</h3>`;
  html += `<table class="stats"><tr><th>Mercado</th><th>Total</th><th>Acertos</th></tr>`;
  Object.entries(marketMap).forEach(([m,vals])=>{
    html += `<tr><td>${m}</td><td>${vals.total}</td><td>${vals.acertos}</td></tr>`;
  });
  html += `</table>`;

  html += `<h3 style="color:var(--accent);margin-top:12px">Acertos por esporte</h3>`;
  html += `<table class="stats"><tr><th>Esporte</th><th>Total</th><th>Acertos</th></tr>`;
  Object.entries(sportMap).forEach(([s,vals])=>{
    html += `<tr><td>${s}</td><td>${vals.total}</td><td>${vals.acertos}</td></tr>`;
  });
  html += `</table>`;

  estatContent.innerHTML = html;
  estatModal.style.display = 'block';
});

closeEstat.addEventListener('click', ()=> estatModal.style.display = 'none');

/* ============== Inicializar eventos ============== */
generateBtn.addEventListener('click', gerarBilhete);

/* quando 'Somente Futebol' estiver marcado, desative chips de outros esportes (visual) */
onlyFootball.addEventListener('change', ()=>{
  if(onlyFootball.checked){
    document.querySelectorAll('#sportsWrap .chip').forEach(c=>{
      if(c.dataset.value.toLowerCase() !== 'futebol') c.classList.remove('active');
      else c.classList.add('active');
    });
  } else {
    document.querySelectorAll('#sportsWrap .chip').forEach(c=>c.classList.add('active'));
  }
});

/* Prefill: se nunca gerou bilhete, mostramos instru√ß√£o */
if(!localStorage.getItem('historicoBilhetes')){
  localStorage.setItem('historicoBilhetes', JSON.stringify([]));
}

/* Quick generate first time to show example (comment if you prefer empty) */
//gerarBilhete();

</script>
</body>
</html>